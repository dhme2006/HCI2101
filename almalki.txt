<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù„Ø¹Ø¨Ø© Ù†ÙˆØ±Ù‡ ğŸ®</title>
  <style>
    body{
      margin:0; font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial;
      background: radial-gradient(circle at top, #ffe6f2, #fff);
      color:#222; display:flex; min-height:100vh; align-items:center; justify-content:center;
    }
    .card{
      width:min(920px, 92vw);
      background:#ffffffcc; backdrop-filter: blur(6px);
      border:1px solid #ffd1e6; border-radius:18px;
      box-shadow: 0 12px 40px rgba(0,0,0,.08);
      padding:18px;
    }
    h1{ margin: 0 0 8px; font-size: 26px; }
    .sub{ opacity:.8; margin:0 0 12px; }
    .row{ display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
    .pill{
      background:#ffeff7; border:1px solid #ffd1e6;
      padding:8px 10px; border-radius:999px; font-size:14px;
    }
    canvas{
      width:100%; height:auto; border-radius:14px;
      background: linear-gradient(180deg, #fff, #fff7fb);
      border:1px solid #ffd1e6;
      display:block;
    }
    button{
      cursor:pointer; border:none; border-radius:12px;
      padding:10px 14px; font-weight:700;
      background:#ff4da6; color:white;
      box-shadow: 0 10px 18px rgba(255,77,166,.25);
    }
    button:active{ transform: translateY(1px); }
    .hint{ font-size:13px; opacity:.75; margin-top:10px; line-height:1.7; }
  </style>
</head>
<body>
  <div class="card">
    <h1>ğŸ Ù„Ø¹Ø¨Ø© Ù†ÙˆØ±Ù‡</h1>
    <p class="sub">ÙŠØ§ Ù†ÙˆØ±Ù‡! Ø§Ø¬Ù…Ø¹ÙŠ Ø§Ù„Ù‚Ù„ÙˆØ¨ â¤ï¸ ÙˆØªØ¬Ù†Ù‘Ø¨ÙŠ Ø§Ù„Ù†Ø¬ÙˆÙ… â­ â€” Ø§Ù„Ø£Ø³Ù‡Ù…/WSAD Ù„Ù„ØªØ­Ø±ÙŠÙƒ</p>

    <div class="row" style="margin-bottom:12px;">
      <div class="pill">Ø§Ù„Ù†ØªÙŠØ¬Ø©: <b id="score">0</b></div>
      <div class="pill">Ø£ÙØ¶Ù„ Ù†ØªÙŠØ¬Ø©: <b id="best">0</b></div>
      <div class="pill">Ø§Ù„ÙˆÙ‚Øª: <b id="time">30</b> Ø«Ø§Ù†ÙŠØ©</div>
      <button id="startBtn">Ø§Ø¨Ø¯Ø£ÙŠ ğŸ®</button>
    </div>

    <canvas id="game" width="900" height="460" aria-label="Noorah Game"></canvas>

    <div class="hint">
      âœ… Ø§Ù„Ù‡Ø¯Ù: Ø§Ø¬Ù…Ø¹ÙŠ Ø£ÙƒØ¨Ø± Ø¹Ø¯Ø¯ Ù…Ù† Ø§Ù„Ù‚Ù„ÙˆØ¨ Ø®Ù„Ø§Ù„ 30 Ø«Ø§Ù†ÙŠØ©.<br/>
      âŒ¨ï¸ Ø§Ù„ØªØ­Ø±ÙŠÙƒ: Ø§Ù„Ø£Ø³Ù‡Ù… Ø£Ùˆ W A S D.<br/>
      ğŸ” Ø¥Ø°Ø§ ØµØ¯Ù…ØªÙŠ Ù†Ø¬Ù…Ø©: ØªØ®Ø³Ø±ÙŠÙ† 2 Ù†Ù‚Ø§Ø· (Ù…Ø§ ØªÙ†Ø²Ù„ ØªØ­Øª ØµÙØ±).<br/>
      ğŸ’– Ø¥Ù‡Ø¯Ø§Ø¡ Ø¨Ø³ÙŠØ· Ù„Ø¹Ù…Ù‘ØªÙŠ Ù†ÙˆØ±Ù‡.
    </div>
  </div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    const scoreEl = document.getElementById("score");
    const bestEl  = document.getElementById("best");
    const timeEl  = document.getElementById("time");
    const startBtn= document.getElementById("startBtn");

    const W = canvas.width, H = canvas.height;

    let keys = {};
    let running = false;
    let score = 0;
    let best = Number(localStorage.getItem("noorah_best") || 0);
    bestEl.textContent = best;

    let timeLeft = 30;
    let timerId = null;
    let rafId = null;

    const player = { x: W/2, y: H/2, r: 16, speed: 4.2 };

    const heart = { x: 120, y: 120, r: 14 };
    const star  = { x: 760, y: 300, r: 15, vx: 2.4, vy: 1.9 };

    function rnd(min, max){ return Math.random() * (max-min) + min; }
    function dist(a,b){ return Math.hypot(a.x-b.x, a.y-b.y); }

    function reset(){
      score = 0;
      timeLeft = 30;
      scoreEl.textContent = score;
      timeEl.textContent = timeLeft;

      player.x = W/2; player.y = H/2;

      heart.x = rnd(40, W-40);
      heart.y = rnd(40, H-40);

      star.x = rnd(60, W-60);
      star.y = rnd(60, H-60);
      star.vx = (Math.random() < 0.5 ? -1 : 1) * rnd(1.8, 3.2);
      star.vy = (Math.random() < 0.5 ? -1 : 1) * rnd(1.6, 3.0);
    }

    function drawRoundedLabel(text, x, y){
      ctx.save();
      ctx.font = "700 18px system-ui, -apple-system, Segoe UI, Tahoma, Arial";
      const padX = 12, padY = 8;
      const w = ctx.measureText(text).width + padX*2;
      const h = 28 + padY;
      const r = 12;

      ctx.fillStyle = "rgba(255,255,255,.85)";
      ctx.strokeStyle = "rgba(255,77,166,.35)";
      ctx.lineWidth = 2;

      roundRect(x - w/2, y - h/2, w, h, r);
      ctx.fill(); ctx.stroke();

      ctx.fillStyle = "#ff2d95";
      ctx.fillText(text, x - ctx.measureText(text).width/2, y + 7);
      ctx.restore();
    }

    function roundRect(x, y, w, h, r){
      ctx.beginPath();
      ctx.moveTo(x+r, y);
      ctx.arcTo(x+w, y, x+w, y+h, r);
      ctx.arcTo(x+w, y+h, x, y+h, r);
      ctx.arcTo(x, y+h, x, y, r);
      ctx.arcTo(x, y, x+w, y, r);
      ctx.closePath();
    }

    function draw(){
      ctx.clearRect(0,0,W,H);

      // title
      drawRoundedLabel("Ù†ÙˆØ±Ù‡ ğŸ’–", W/2, 36);

      // heart (collect)
      ctx.save();
      ctx.font = "28px system-ui";
      ctx.fillText("â¤ï¸", heart.x-14, heart.y+10);
      ctx.restore();

      // star (avoid)
      ctx.save();
      ctx.font = "28px system-ui";
      ctx.fillText("â­", star.x-14, star.y+10);
      ctx.restore();

      // player
      ctx.beginPath();
      ctx.arc(player.x, player.y, player.r, 0, Math.PI*2);
      ctx.fillStyle = "#ff4da6";
      ctx.fill();
      ctx.lineWidth = 4;
      ctx.strokeStyle = "rgba(255,255,255,.9)";
      ctx.stroke();

      // small face
      ctx.save();
      ctx.fillStyle = "rgba(255,255,255,.95)";
      ctx.beginPath(); ctx.arc(player.x-5, player.y-3, 2.2, 0, Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc(player.x+5, player.y-3, 2.2, 0, Math.PI*2); ctx.fill();
      ctx.strokeStyle = "rgba(255,255,255,.95)";
      ctx.lineWidth = 2;
      ctx.beginPath(); ctx.arc(player.x, player.y+4, 6, 0.15*Math.PI, 0.85*Math.PI); ctx.stroke();
      ctx.restore();

      if(!running){
        ctx.save();
        ctx.fillStyle = "rgba(0,0,0,.06)";
        ctx.fillRect(0,0,W,H);
        ctx.fillStyle = "#222";
        ctx.font = "700 26px system-ui";
        const msg = "Ø§Ø¶ØºØ·ÙŠ (Ø§Ø¨Ø¯Ø£ÙŠ ğŸ®) ÙˆØ¨Ø¹Ø¯ÙŠÙ† ØªØ­Ø±ÙƒÙŠ!";
        ctx.fillText(msg, W/2 - ctx.measureText(msg).width/2, H/2);
        ctx.restore();
      }
    }

    function update(){
      // movement
      const up = keys["ArrowUp"] || keys["w"] || keys["W"];
      const down = keys["ArrowDown"] || keys["s"] || keys["S"];
      const left = keys["ArrowLeft"] || keys["a"]